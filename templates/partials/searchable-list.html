<script src="/js/search.js"></script>

{{ define "partials/inline/button-checkbox" }}
<!-- prettier-ignore -->
{{ $label := .value }}
{{ $partial := .partial }}
{{ $type := .type }}
<div class="inline-block">
  <input
    class="peer hidden"
    type="checkbox"
    data-filter="{{ jsonify . }}"
    id="{{$type}}:{{$label}}"
    name="{{$type}}:{{$label}}"
    onchange="updateSearch()"
  />
  <label
    class="hover:bg-accent-light bg-white px-3 p-2 peer-checked:bg-accent-light peer-checked:outline-8"
    for="{{$type}}:{{$label}}"
  >
    <!-- prettier-ignore -->
    {{ if $partial }}
    {{ partial $partial $label }}
    {{ else }}
    {{ $label }}
    {{ end }}
  </label>
</div>
{{ end }}

<!-- outer div in relative to create a context for the absolute-positioned svg

     A lot of this concept is copied from https://www.swyx.io/ideas/ -->
<div class="relative">
  {{ partial "searchbox" . }}
  <!-- prettier-ignore -->
  {{ $sections := (slice) }}
  {{ range . }}
  {{ with .Section }}
  {{ $sections = (union $sections (slice .)) }}
  {{ end }}
  {{ end }}
  {{ $languages := (slice) }}
  {{ range . }}
  {{ with .Params.language }}
  {{ $languages = (union $languages (slice .)) }}
  {{ end }}
  {{ end }}
  <div id="filters" class="items-center flex space-x-2 my-2">
    {{ partial "ionicons-filter" "h-5 w-5" }}
    <div class="flex my-2">
      {{ range $languages }}
      <!-- prettier-ignore -->
      {{ partial "inline/button-checkbox"
                   (dict "value" .
                         "partial" "func-language-code-to-name"
                         "type" "language") }}
      {{ end }}
    </div>
    <!-- <div class="flex my-2">
         {{ range $sections }}
         {{ partial "inline/button-checkbox"
         (dict "value" .
         "type" "section") }}
         {{ end }}
         </div> -->
  </div>
</div>
<ul id="posts" class="mt-8 flex flex-col gap-4">
  <!-- prettier-ignore -->
  {{ range . }}
  {{ if not (.Param "special") }}
  {{ $extra_params := (dict "section" .Section)}}
  <li data-params="{{ jsonify (merge .Params $extra_params) }}">
    <div class="h-6">
      <span class="inline-block w-[10ch]">{{ partial "date" .Date }}</span>
      {{ if eq .Section "translated" }}
      <span class="bg-green-500 text-white p-1">TRANSLATED</span>
      {{ end }}
      <a href="{{.Permalink}}" class="link font-bold"
        >{{ partial "func-cover-title" (dict "item" . "mark" true)}}</a
      >
    </div>
  </li>
  <!-- prettier-ignore -->
  {{ end }}
  {{ end }}
</ul>
