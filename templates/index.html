{{ define "main" }}
<div class="side-layout">
  <main>
    <h1 class="text-4xl">Kisaragi Hiu</h1>
    {{ partial "content" . }}
    <hr class="mt-8" />
    <h1 class="text-xl">Posts</h1>
    <ul class="index">
      <!-- prettier-ignore -->
      {{ range (sort (union (where .Site.RegularPages "Section" "")
                            (where .Site.RegularPages "Section" "blog"))
                     "Date"
                     "desc") }}
      {{ if not (.Param "special") }}
      <li>{{ partial "index-item" . }}</li>
      {{ end }} {{ end }}
    </ul>
  </main>
  <aside>
    <!-- prettier-ignore -->
    {{ $illust_featured := (slice) }}
    {{ range (where .Site.RegularPages "Section" "illust") }}
      {{ if (eq (.Date.Format "2006-01") (now.Format "2006-01")) }}
        {{ $illust_featured = $illust_featured | append .}}
      {{ end }}
    {{ end }}
    {{ with $illust_featured }}
    <h1>
      <a class="text-primary" href="/illust.html"
        >Illustrations ({{now.Format "2006-01"}})</a
      >
    </h1>
    <ul class="illust-index">
      {{ range . }}
      <li>{{ partial "illust-item" . }}</li>
      {{ end }}
    </ul>
    {{end}}
    <!-- Use func-page-term(., tags) instead of .GetTerms(tags) or .Site.Taxonomies.tags.
         Because those do not list tags that are only declared in taxonomy term pages.

         "Tagging tags" isn't a well-supported thing in Hugo (yet?).
    -->
    <!-- prettier-ignore -->
    {{ $alltags := (slice) }}
    {{ range .Site.AllPages }}
    {{ $alltags = (union $alltags
                         (partial "func-page-term"
                                  (dict "page" . "taxonomy" "tags")))}}
    {{ end }}

    <!-- Sort them -->
    {{ $alltags = (sort $alltags "Title") }}

    <!-- Actually display them -->
    {{ with $alltags }}
    <h1>Tags</h1>
    {{ partial "tags-block" . }} {{ end }}
  </aside>
</div>
{{ end }}
