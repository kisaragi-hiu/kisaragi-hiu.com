{{ define "main" }}
<div class="side-layout">
  <main>
    <div class="my-8"></div>
    {{ partial "content" . }}
    <hr class="my-8" />
    <ul class="flex flex-col">
      <!-- prettier-ignore -->
      {{ range (sort (union (where .Site.RegularPages "Section" "")
                            (where .Site.RegularPages "Section" "blog"))
                     "Date"
                     "desc") }}
      {{ if not (.Param "special") }}
      <li>{{ partial "index-item" . }}</li>
      {{ end }} {{ end }}
    </ul>
  </main>
  <aside>
    <!-- <nav class="flex flex-wrap justify-start gap-3 my-2"> -->
    <nav class="flex flex-col">
      <!-- prettier-ignore -->
      {{ range (slice (slice "/" "Blog")
                      (slice "/covers.html" "Covers")
                      (slice "/illust.html" "Illust")
                      (slice "/projects.html" "Projects")
                      (slice "/about.html" "About")
                      (slice "/index.xml" "RSS")) }}
      <a class="" href="{{ index . 0 }}">{{ index . 1 }}</a>
      {{ end }}
    </nav>
    <!-- prettier-ignore -->
    {{ $covers_featured := (slice) }}
    {{ range (where .Site.RegularPages "Section" "covers") }}
      {{ if (eq (.Date.Format "2006-01") (now.Format "2006-01")) }}
        {{ $covers_featured = $covers_featured | append .}}
      {{ end }}
    {{ end }}
    {{ with $covers_featured }}
    <h1>
      <a class="text-primary" href="/covers.html"
        >Covers ({{now.Format "2006-01"}})</a
      >
    </h1>
    {{ partial "covers" . }}
    {{end}}
    <!-- prettier-ignore -->
    {{ $illust_featured := (slice) }}
    {{ range (where .Site.RegularPages "Section" "illust") }}
      {{ if (eq (.Date.Format "2006-01") (now.Format "2006-01")) }}
        {{ $illust_featured = $illust_featured | append .}}
      {{ end }}
    {{ end }}
    {{ with $illust_featured }}
    <h1>
      <a class="text-primary" href="/illust.html"
        >Illustrations ({{now.Format "2006-01"}})</a
      >
    </h1>
    <ul class="illust-index">
      {{ range . }}
      <li>{{ partial "illust-item" . }}</li>
      {{ end }}
    </ul>
    {{end}}
    <!-- Use func-page-term(., tags) instead of .GetTerms(tags) or .Site.Taxonomies.tags.
         Because those do not list tags that are only declared in taxonomy term pages.

         "Tagging tags" isn't a well-supported thing in Hugo (yet?).
    -->
    <!-- prettier-ignore -->
    {{ $alltags := (slice) }}
    {{ range .Site.AllPages }}
    {{ $alltags = (union $alltags
                         (partial "func-page-term"
                                  (dict "page" . "taxonomy" "series")))}}
    {{ end }}

    <!-- Sort them -->
    {{ $alltags = (sort $alltags "Title") }}

    <!-- Actually display them -->
    {{ with $alltags }}
    <h1>Series</h1>
    <ul
      class="list-none pl-0 flex flex-wrap gap-x-2 gap-y-1 leading-loose my-4"
    >
      {{ range . }}
      <li>{{ partial "series" . }}</li>
      {{ end }}
    </ul>
    <!-- prettier-ignore -->
    {{ end }}
  </aside>
</div>
{{ end }}
